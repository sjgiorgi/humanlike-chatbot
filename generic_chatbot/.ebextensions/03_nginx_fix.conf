container_commands:
  01_nginx_upload_limit:
    command: |
      # Add client_max_body_size to the main nginx server block
      if grep -q "client_max_body_size" /etc/nginx/nginx.conf; then
        echo "client_max_body_size already configured"
      else
        # Find the server block and add the configuration
        sed -i '/server {/a\        client_max_body_size 10M;' /etc/nginx/nginx.conf
        echo "Added client_max_body_size to nginx.conf"
      fi
      
      # Also add to any existing proxy configuration
      if [ -f /etc/nginx/conf.d/proxy.conf ]; then
        if grep -q "client_max_body_size" /etc/nginx/conf.d/proxy.conf; then
          echo "client_max_body_size already in proxy.conf"
        else
          sed -i '1i client_max_body_size 10M;' /etc/nginx/conf.d/proxy.conf
          echo "Added client_max_body_size to proxy.conf"
        fi
      fi
      
      # Create a new config file if needed
      echo "client_max_body_size 10M;" > /etc/nginx/conf.d/upload_limit.conf
      
      # Test nginx configuration
      nginx -t
      
      # Reload nginx
      service nginx reload
